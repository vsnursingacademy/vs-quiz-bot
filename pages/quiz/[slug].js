import { useEffect, useState } from 'react';
import { useRouter } from 'next/router';
import { supabaseClient } from '@/lib/supabaseClient';
export default function QuizLanding(){const router=useRouter();const {slug}=router.query;const [quiz,setQuiz]=useState(null);const [rows,setRows]=useState([]);const bot=process.env.NEXT_PUBLIC_TELEGRAM_BOT_USERNAME;useEffect(()=>{if(!slug)return;(async()=>{const {data:q}=await supabaseClient.from('quizzes').select('*').eq('slug',slug).single();setQuiz(q||null);if(q){const {data:l}=await supabaseClient.from('leaderboard_best_view').select('*').eq('quiz_id',q.id).order('score',{ascending:false}).limit(20);setRows(l||[]);}})()},[slug]);if(!quiz) return <div className="page"><p>Loading…</p></div>;return (<div className="page"><h1>{quiz.title}</h1>{quiz.description&&<p>{quiz.description}</p>}<p>Total Questions: {quiz.total_questions||'—'}</p><div className="card"><h3>How to play</h3><ol><li>Open Telegram and start the bot.</li><li>Send <code>/quiz</code> to begin the latest quiz.</li></ol>{bot&&<p><a href={`https://t.me/${bot}`} target="_blank">Open @{bot}</a></p>}</div><h3>Top Scores</h3><table className="table"><thead><tr><th>#</th><th>Participant</th><th>Score</th><th>Finished</th></tr></thead><tbody>{rows.map((r,i)=>(<tr key={i}><td>{i+1}</td><td>{r.display_name||'Anonymous'}</td><td>{r.score}</td><td>{r.finished_at?new Date(r.finished_at).toLocaleString():'-'}</td></tr>))}</tbody></table></div>)}
