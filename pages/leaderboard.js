import { supabaseClient } from '@/lib/supabaseClient';
import { useEffect, useState } from 'react';
export default function Leaderboard(){const [rows,setRows]=useState([]);const [quizId,setQuizId]=useState('all');const [quizzes,setQuizzes]=useState([]);const [mode,setMode]=useState('latest');useEffect(()=>{(async()=>{const {data:qz}=await supabaseClient.from('quizzes').select('id,title').order('created_at',{ascending:false});setQuizzes(qz||[]);})()},[]);useEffect(()=>{(async()=>{const view=mode==='best'?'leaderboard_best_view':'leaderboard_view';let q=supabaseClient.from(view).select('*');if(quizId!=='all') q=q.eq('quiz_id',quizId);const {data}=await q.order('score',{ascending:false}).order('finished_at',{ascending:true}).limit(50);setRows(data||[]);})()},[quizId,mode]);return (<div className="page"><h2>Leaderboard</h2><div className="row"><label>Quiz:&nbsp;</label><select value={quizId} onChange={e=>setQuizId(e.target.value)}><option value="all">All quizzes</option>{quizzes.map(q=><option key={q.id} value={q.id}>{q.title}</option>)}</select><label>Mode:&nbsp;</label><select value={mode} onChange={e=>setMode(e.target.value)}><option value="latest">Latest attempts</option><option value="best">Best per user</option></select></div><table className="table"><thead><tr><th>#</th><th>Participant</th><th>Quiz</th><th>Score</th><th>Finished</th></tr></thead><tbody>{rows.map((r,i)=>(<tr key={`${r.quiz_id}-${r.user_id}-${i}`}><td>{i+1}</td><td>{r.display_name||'Anonymous'}</td><td>{r.quiz_title}</td><td>{r.score}</td><td>{r.finished_at?new Date(r.finished_at).toLocaleString():'-'}</td></tr>))}</tbody></table></div>)}
